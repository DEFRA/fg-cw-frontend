{% from "govuk/components/table/macro.njk" import govukTable %}

{%- set notesHistory = params.notesHistory -%}

{% if notesHistory and notesHistory.length > 0 %}
  <div class="notes-history-table govuk-!-margin-top-8">
    <h2 class="govuk-heading-m">Outcome history</h2>

    {% set rows = [] %}
    {% for note in notesHistory %}
      {%- set formattedDate = note.date | formatDate("d MMM yyyy") if note.date else "" -%}
      {%- set sortableDate = note.date | formatDate("yyyy-MM-dd") if note.date else "" -%}
      {%
        set row = [
          {
            text: formattedDate,
            attributes: { "data-sort-value": sortableDate }
          },
          { text: note.outcome if note.outcome else "" },
          { text: note.note if note.note else "", classes: "govuk-!-width-one-half" },
          { text: note.addedBy if note.addedBy else "" }
        ]
      %}
      {% set rows = (rows.push(row), rows) %}
    {% endfor %}

    {{
      govukTable({
        attributes: { "data-module": "moj-sortable-table" },
        captionClasses: "govuk-table__caption--m",
        firstCellIsHeader: false,
        head: [
          {
            text: "Date",
            classes: "govuk-!-width-one-quarter",
            attributes: { "aria-sort": "descending" }
          },
          {
            text: "Outcome",
            classes: "govuk-!-width-one-quarter",
            attributes: { "aria-sort": "ascending" }
          },
          {
            text: "Note",
            classes: "govuk-!-width-one-half"
          },
          {
            text: "Added by",
            attributes: { "aria-sort": "ascending" }
          }
        ],
        rows: rows
      })
    }}
  </div>
{% endif %}
