{%- from "govuk/components/textarea/macro.njk" import govukTextarea -%}
{%- from "../task-outcome-selector/macro.njk" import taskOutcomeSelector -%}

{%- set error = params.error -%}
{%- set formAction = params.formAction -%}
{%- set status = params.status -%}
{%- set statusOptions = params.statusOptions -%}
{%- set completed = params.completed -%}
{%- set commentInputDef = params.commentInputDef -%}
{%- set commentText = params.commentText -%}
{%- set isInteractive = params.isInteractive if params.isInteractive !== undefined else true -%}
{%- set isDisabled = isInteractive === false -%}

<form method="post" id="completeTaskForm" action="{{ formAction }}">
  <div class="govuk-form-group">
    {{
      taskOutcomeSelector({
        status: status,
        statusOptions: statusOptions,
        completed: completed,
        errorMessage: error,
        isDisabled: isDisabled
      })
    }}
  </div>

  {% if commentInputDef %}
    {% if isDisabled %}
      {{
        govukTextarea({
          id: "comment",
          name: "comment",
          label: {
            text: commentInputDef.label,
            classes: "govuk-label--m"
          },
          hint: {
            text: commentInputDef.helpText
          },
          errorMessage: error,
          disabled: true,
          attributes: {
            "aria-disabled": "true"
          },
          value: commentText
        })
      }}
    {% else %}
      {{
        govukTextarea({
          id: "comment",
          name: "comment",
          label: {
            text: commentInputDef.label,
            classes: "govuk-label--m"
          },
          hint: {
            text: commentInputDef.helpText
          },
          errorMessage: error,
          value: commentText
        })
      }}
    {% endif %}
  {% endif %}

  {% if isInteractive %}
    <div class="govuk-button-group">
      <button
        type="submit"
        data-prevent-double-click="true"
        data-testid="save-and-continue-button"
        class="govuk-button"
        data-module="govuk-button"
        data-govuk-button-init=""
      >
        Save and continue
      </button>
    </div>
  {% endif %}
</form>
