{% extends '../layouts/case-layout.njk' %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/textarea/macro.njk" import govukTextarea %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "govuk/components/tag/macro.njk" import govukTag -%}
{% from "govuk/components/service-navigation/macro.njk" import govukServiceNavigation %}
{% from "../components/case-summary/macro.njk" import caseSummary %}
{% from "../components/case-details-tab-navigation/macro.njk" import caseDetailsTabNavigation %}
{% from "../components/copy-to-clipboard/macro.njk" import copyToClipboard %}

{% macro link(href, text) -%}
  <a href="{{ href | escape }}" target="_blank" rel="noopener noreferrer">
    {{ text | escape }}
  </a>
{%- endmacro %}

{% block content %}
  {{ caseSummary(data) }}

  <div class="govuk-body">
    {{ govukServiceNavigation({ navigation: data.links }) }}

    <h2 class="govuk-heading-l govuk-!-margin-top-6">{{ pageHeading }}</h2>

    {{
      govukInsetText({
        text: "Check the grant funding agreement system to see the final terms of the agreement."
      })
    }}

    <p><strong>Agreement name:</strong> {{ data.agreementName }}</p>

    {% if data.agreements.rows.length > 0 %}
      {% set rows = [] %}
      {% for row in data.agreements.rows %}
        {%
          set row = [
            row.ref,
            row.date,
            {
              html: link(row.internalUrl.href, row.internalUrl.text)
                      + '&nbsp;&nbsp;&nbsp;&nbsp;'
                      + copyToClipboard({
                      text: row.externalUrl.href,
                      buttonText: row.externalUrl.text
                    })
            },
            {
              html: govukTag({
                text: row.status.text,
                classes: row.status.classes
              })
            }
          ]
        %}
        {% set rows = (rows.push(row), rows) %}
      {% endfor %}

      {{
        govukTable({
          head: data.agreements.head,
          rows: rows
        })
      }}
    {% endif %}
  </div>
{% endblock %}
