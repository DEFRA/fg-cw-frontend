{% extends 'layouts/page.njk' %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{#  
-- caseData example
{
    _id: '6809fe3d6169ff02cc99ab2a',
    workflowCode: 'GRANT-REF-1',
    caseRef: 'APPLICATION-REF-1',
    status: 'NEW',
    dateReceived: '2025-03-27T11:34:52.000Z',
    targetDate: '2025-04-27T11:34:52.000Z',
    priority: 'MEDIUM',
    assignedUser: 'Mark Ford',
    taskSections: [
        { id: '1', title: 'Check application', taskGroups: [Array] },
        {
        id: '2',
        title: 'Make Application Decision',
        taskGroups: [Array]
        }
    ],
    payload: {
        clientRef: 'APPLICATION-REF-1',
        code: 'GRANT-REF-1',
        createdAt: '2025-03-27T10:34:52.000Z',
        submittedAt: '2025-03-28T11:30:52.000Z',
        identifiers: {
        sbi: 'SBI001',
        frn: 'FIRM0001',
        crn: 'CUST0001',
        defraId: 'DEFRA0001'
        },
        answers: {
        scheme: 'SFI',
        year: 2025,
        hasCheckedLandIsUpToDate: true,
        actionApplications: [Array]
        }
    }
    }
#}

{% block content %}
  <h1 class="govuk-heading-xl">Application</h1>
  <p class="govuk-body govuk-!-margin-bottom-6">
    Application submitted: <strong>1 Jul 2024</strong>
  </p>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="govuk-body" data-testid="app-page-body">
        <h2
          class="govuk-heading-m"
          style="border-bottom: 2px solid #1d70b8; padding-bottom: 4px;"
        >
          Applicant details
        </h2>

        <dl class="govuk-summary-list govuk-!-margin-bottom-6">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">First name</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.firstName or "N/A" }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Last name</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.lastName or "N/A" }}
            </dd>
          </div>
        </dl>

        <h2
          class="govuk-heading-m"
          style="border-bottom: 2px solid #1d70b8; padding-bottom: 4px;"
        >
          Business details
        </h2>

        <dl class="govuk-summary-list govuk-!-margin-bottom-6">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Business name</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.businessName }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">SBI number</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.identifiers.sbi }}
            </dd>
          </div>
        </dl>

        <h2
          class="govuk-heading-m"
          style="border-bottom: 2px solid #1d70b8; padding-bottom: 4px;"
        >
          Land details
        </h2>

        <dl class="govuk-summary-list govuk-!-margin-bottom-6">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Do digital maps show correct land details?
            </dt>
            <dd class="govuk-summary-list__value">
              {% if caseData.payload.answers.hasCheckedLandIsUpToDate %}Yes{% else %}No{% endif %}
            </dd>
          </div>
        </dl>

        <h2
          class="govuk-heading-m"
          style="border-bottom: 2px solid #1d70b8; padding-bottom: 4px;"
        >
          Land parcels
        </h2>

        <dl class="govuk-summary-list govuk-!-margin-bottom-6">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Land parcel ID</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.answers.landParcelId }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Total size</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.answers.totalSize }} ha
            </dd>
          </div>
        </dl>

        <h2
          class="govuk-heading-m"
          style="border-bottom: 2px solid #1d70b8; padding-bottom: 4px;"
        >
          Answers
        </h2>

        <dl class="govuk-summary-list govuk-!-margin-bottom-6">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Scheme</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.answers.scheme }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Year</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.payload.answers.year }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Has checked land is up to date
            </dt>
            <dd class="govuk-summary-list__value">
              {% if caseData.payload.answers.hasCheckedLandIsUpToDate %}Yes{% else %}No{% endif %}
            </dd>
          </div>
        </dl>

        {# 
                   -- answers.actionApplications

                [
                {
                    parcelId: '9238',
                    sheetId: 'SX0679',
                    code: 'CSAM1',
                    appliedFor: { unit: 'ha', quantity: 20.23 }
                }
                ] #}

        {% if caseData.payload.answers.actionApplications.length %}
          <h2
            class="govuk-heading-m"
            style="border-bottom: 2px solid #1d70b8; padding-bottom: 4px;"
          >
            Actions
          </h2>

          {% for action in caseData.payload.answers.actionApplications %}
            <dl class="govuk-summary-list govuk-!-margin-bottom-6">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                  Selected land parcel<br />for action {{ loop.index }}
                </dt>
                <dd class="govuk-summary-list__value">
                  {{ action.parcelId or "N/A" }}
                </dd>
              </div>

              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Action {{ loop.index }}</dt>
                <dd class="govuk-summary-list__value">
                  {{ action.code }}: {{ action.description or "N/A" }}
                </dd>
              </div>

              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Available</dt>
                <dd class="govuk-summary-list__value">
                  {{ action.available or "N/A" }}
                </dd>
              </div>

              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Quantity</dt>
                <dd class="govuk-summary-list__value">
                  {% if action.appliedFor %}
                    {{ action.appliedFor.quantity }}
                    {{ action.appliedFor.unit }}
                  {% else %}
                    Not specified
                  {% endif %}
                </dd>
              </div>
            </dl>
          {% endfor %}
        {% else %}
          <p class="govuk-body">No action applications data available.</p>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}
{% endblock %}
